# 셀프 리뷰 작성 가이드

## 셀프 리뷰란?

셀프 리뷰는 본인이 작성한 PR에 대해 변경사항을 설명하는 리뷰입니다. 코드 리뷰(문제점을 찾는 것)와 달리, 셀프 리뷰는:

- 변경한 이유를 설명
- 구현 방식을 문서화
- 리뷰어가 알아야 할 컨텍스트 제공
- 주의가 필요한 부분을 강조

## 코멘트 타입별 가이드

### 💡 변경 이유

**언제 사용하나요?**
- 새로운 기능이나 로직을 추가할 때
- 기존 코드를 수정하거나 삭제할 때
- 리팩토링의 목적을 설명할 때

**좋은 예시:**
```markdown
#### 💡 변경 이유

기존 `UsersRepository`에 있던 `checkExistByHashedPhoneNumber` 함수를
`UserIdentityService`로 이동했습니다.

이유:
1. 핸드폰 번호 검증은 identity 관련 로직이므로 책임 분리
2. SMS 인증과 중복 체크를 한 곳에서 처리하여 일관성 확보
3. 향후 다른 identity 검증 로직 추가 시 확장 용이
```

**피해야 할 예시:**
```markdown
#### 💡 변경 이유

함수를 옮겼습니다.
```
→ WHY가 없음. 왜 옮겼는지 설명 필요.

---

### 🔧 구현 방식

**언제 사용하나요?**
- 여러 구현 방식 중 하나를 선택했을 때
- 특정 패턴이나 라이브러리를 사용한 이유
- 성능이나 안전성을 고려한 구현일 때

**좋은 예시:**
```markdown
#### 🔧 구현 방식

`verifyAndCheckPhone` 메서드는 다음 순서로 동작합니다:

1. SMS 인증 코드 검증 (SmsVerificationService)
2. 핸드폰 번호 해싱
3. 해시된 번호로 중복 체크

이 순서를 선택한 이유:
- 인증 실패 시 불필요한 해싱/DB 조회 방지
- 해시 값을 반환하여 호출자가 재사용 가능
```

**피해야 할 예시:**
```markdown
#### 🔧 구현 방식

함수를 만들었습니다.
```
→ 코드를 보면 알 수 있는 내용. 구현의 "이유"나 "선택"을 설명해야 함.

---

### ⚠️ 주의사항

**언제 사용하나요?**
- Breaking change가 있을 때
- 배포 전 확인이 필요한 사항
- 잠재적 위험이 있는 변경
- 특별히 신경 써서 리뷰해야 할 부분

**좋은 예시:**
```markdown
#### ⚠️ 주의사항

이 변경으로 `User` 스키마에서 `phoneNumber` 필드가 제거됩니다.

확인 필요사항:
- [ ] 기존 데이터 마이그레이션 스크립트 준비
- [ ] phoneNumber를 사용하는 다른 서비스 확인
- [ ] 프로덕션 배포 전 스테이징에서 테스트
```

**피해야 할 예시:**
```markdown
#### ⚠️ 주의사항

조심하세요.
```
→ 무엇을 조심해야 하는지 구체적으로 명시 필요.

---

### 🔗 관련 변경

**언제 사용하나요?**
- 여러 파일에 걸친 변경이 있을 때
- 다른 파일의 변경과 연관된 수정일 때
- 변경의 의존 관계를 설명할 때

**좋은 예시:**
```markdown
#### 🔗 관련 변경

이 테스트 파일의 mock 수정은 다음 변경과 연관됩니다:
- `user-identity.service.ts`: `verifyAndCheckPhone` 메서드 추가
- `auth.service.ts`: 핸드폰 검증 로직 마이그레이션

`UserIdentityService`의 새 메서드를 mock하도록 테스트를 업데이트했습니다.
```

---

### 📝 TODO

**언제 사용하나요?**
- 후속 작업이 필요한 경우
- 이번 PR 범위에서 제외된 개선사항
- 기술 부채로 남겨둔 부분

**좋은 예시:**
```markdown
#### 📝 TODO

현재는 핸드폰 번호만 마이그레이션했습니다.
이메일 검증 로직도 동일한 패턴으로 마이그레이션 예정입니다.

관련 태스크: IST-2021
```

---

## 셀프 리뷰 작성 팁

### DO ✅

1. **비즈니스 컨텍스트 제공**
   - 왜 이 기능이 필요한지
   - 어떤 문제를 해결하는지

2. **기술적 결정 설명**
   - 왜 이 방식을 선택했는지
   - 고려했던 대안은 무엇인지

3. **리뷰어를 위한 가이드**
   - 어느 부분을 중점적으로 봐야 하는지
   - 어떤 순서로 코드를 읽으면 좋은지

4. **구체적인 예시 포함**
   - Before/After 비교
   - 실제 사용 시나리오

### DON'T ❌

1. **코드를 그대로 설명하지 않기**
   - ❌ "userId 변수를 추가했습니다"
   - ✅ "사용자 추적을 위해 userId를 전달받도록 변경했습니다"

2. **너무 많은 코멘트 달지 않기**
   - 모든 줄에 코멘트를 달 필요 없음
   - 의미 있는 변경에만 집중

3. **당연한 내용 설명하지 않기**
   - 타입 수정, 오타 수정 등은 설명 불필요
   - 코드만 봐도 이해되는 내용은 생략

4. **변명하지 않기**
   - ❌ "시간이 없어서 이렇게 했습니다"
   - ✅ "현재는 간단한 구현으로 두고, 추후 개선 예정입니다 (TODO)"

---

## 전체 리뷰 요약 작성 가이드

### 템플릿

```markdown
## 셀프 리뷰

이 PR의 변경사항을 설명하는 셀프 리뷰입니다.

### 주요 변경사항
- [가장 중요한 변경 1]
- [가장 중요한 변경 2]
- [가장 중요한 변경 3]

### 변경 배경
[왜 이 변경이 필요했는지 1-2문장으로 설명]

### 리뷰어 참고사항
- [중점적으로 봐야 할 부분]
- [주의가 필요한 변경]
- [질문이나 피드백이 필요한 부분]

### 테스트
- [테스트 방법이나 결과]
- [수동 테스트가 필요한 경우 방법]
```

### 예시

```markdown
## 셀프 리뷰

이 PR의 변경사항을 설명하는 셀프 리뷰입니다.

### 주요 변경사항
- 핸드폰 번호 검증 로직을 `UserIdentityService`로 통합
- `User` 스키마에서 `phoneNumber` 필드 제거
- 관련 테스트 코드 업데이트

### 변경 배경
핸드폰 인증 관련 로직이 여러 모듈에 분산되어 있어 유지보수가 어려웠습니다.
이번 변경으로 identity 관련 로직을 한 곳에서 관리할 수 있게 됩니다.

### 리뷰어 참고사항
- `verifyAndCheckPhone` 메서드의 반환 타입을 중점적으로 확인해주세요
- 스키마 변경으로 인한 마이그레이션이 필요할 수 있습니다
- IST-2019 PR과 함께 배포되어야 합니다

### 테스트
- 단위 테스트 추가 완료
- 로컬에서 회원가입 플로우 수동 테스트 완료
```

---

## GitHub MCP 도구 사용

### 필요한 도구

```
mcp__github__pull_request_review_write   - pending 리뷰 생성
mcp__github__add_comment_to_pending_review - 인라인 코멘트 추가
```

### 워크플로우

```
1. ToolSearch로 MCP 도구 로드
   ↓
2. PR 정보 수집 (PR 번호, commit SHA, owner/repo)
   ↓
3. pending 리뷰 생성 (전체 요약 포함)
   ↓
4. 인라인 코멘트 추가 (파일별 설명)
   ↓
5. 사용자가 PR 페이지에서 'Submit review' 클릭
```

### 주의사항

1. **pending 리뷰 먼저 생성**: 인라인 코멘트 추가 전에 반드시 pending 리뷰 생성
2. **side는 항상 RIGHT**: 새로 추가/수정된 코드에 코멘트하므로 `side: "RIGHT"`
3. **삭제된 파일 제외**: 삭제된 파일에는 코멘트 불가
4. **병렬 호출 가능**: 여러 인라인 코멘트는 병렬로 추가 가능
